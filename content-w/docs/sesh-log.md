+++
title = "Session logging"
author = ["Clint Jordan"]
description = " "
date = "2023-01-20"
lastmod = ""
tags = ["script"]
categories = ["docs"]
draft = false
autonumber = false
printmode = false
+++

Keeping thorough records for every ticket is essential not only for the
developers that we work with, but for ourselves as well. If our work were to
ever come into question, having records in place could end up being very
valuable.  

There are different methods in use out there. The main two I've seen so far are
screenshots and to simply copy/paste the session to a text file. The copy/paste
method is easy enough, but it has very little value with respect to
authenticity. Screenshots have stronger authenticity, but it can be very time
consuming if running commands with long output. Also, it's probably less helpful
for developers since they can't copy/paste the session contents. There is
a better way.

### The Linux Script Utility
It's quite simple. Just start your session with `script`. This will
create a log file containing all your session contents. For example, if I'm
assigned RTASK0001234 which involves some actions on server
`fsxnfsx9999.wrk.fs.usda.gov`, then I would start my session by creating the
directory `logs/RTASK0001234` then run the following command.

{{< code-no-copy lang="text" >}}
script logs/RTASK0001234/fsxnfsx9999.wrk.fs.usda.gov.ts
{{< /code-no-copy >}}

I put the `.ts` extension on the log file because `script` generates typescript
files, which contains ANSI escape characters. This is why log files generated
with `script` provide a little more authenticity than a plain text file. While
it's technically possible to counterfeit, it would be very difficult and time
consuming to get it right. If your command prompt and output contain a lot of
formatting, it would be quite difficult to accurately replicate. For
example, consider the session below.

{{< rawhtml >}}
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<style type="text/css">
pre {
  font-family:Courier New;
  font-size:10pt;
  color:#cccccc;
  background-color:#272822;
}

.af_line {
  color: gray;
  text-decoration: none;
}

</style>
<title>test.ts</title>
</head>
<body>
<pre>Script started on 2023-01-11 13:44:30-07:00 [TERM=&quot;screen-256color&quot; TTY=&quot;/dev/pts/3&quot; COLUMNS=&quot;136&quot; LINES=&quot;66&quot;]
<span style="font-weight:bold;color:#5c5cff;">[</span><span style="font-weight:bold;color:#5c5cff;">cjordan</span><span style="font-weight:bold;color:#ff0000;">&#64;</span><span style="font-weight:bold;color:#5c5cff;">HOSTNAME </span><span style="font-weight:bold;color:#00ff00;">~</span><span style="font-weight:bold;color:#ff0000;"></span><span style="font-weight:bold;color:#5c5cff;">]
</span><span style="font-weight:bold;color:#5c5cff;">$</span> date -u
Wed Jan 11 20:44:38 UTC 2023
<span style="font-weight:bold;color:#5c5cff;">[</span><span style="font-weight:bold;color:#5c5cff;">cjordan</span><span style="font-weight:bold;color:#ff0000;">&#64;</span><span style="font-weight:bold;color:#5c5cff;">HOSTNAME </span><span style="font-weight:bold;color:#00ff00;">~</span><span style="font-weight:bold;color:#ff0000;"></span><span style="font-weight:bold;color:#5c5cff;">]
</span><span style="font-weight:bold;color:#5c5cff;">$</span> exit
exit

Script done on 2023-01-11 13:44:41-07:00 [COMMAND_EXIT_CODE=&quot;0&quot;]
</pre>
</body>
</html>
<!--HTML generated by ansifilter 2.18, http://www.andre-simon.de/-->
{{< /rawhtml >}}

This extremely simple session becomes the following including the ANSI escape
characters.

{{< code-no-copy lang="text" >}}
Script started on 2023-01-11 13:44:30-07:00 [TERM="screen-256color" TTY="/dev/pts/3" COLUMNS="136" LINES="66"]
^[[?2004h^[[01;34m[^[[01;34mcjordan^[[01;31m@^[[01;34mHOSTNAME ^[[01;32m~^[[01;31m^[[01;34m]^M^M
^[[01;34m$^[[00m date -u^M
^[[?2004l^MWed Jan 11 20:44:38 UTC 2023^M
^[[?2004h^[[01;34m[^[[01;34mcjordan^[[01;31m@^[[01;34mHOSTNAME ^[[01;32m~^[[01;31m^[[01;34m]^M^M
^[[01;34m$^[[00m exit^M
^[[?2004l^Mexit^M

Script done on 2023-01-11 13:44:41-07:00 [COMMAND_EXIT_CODE="0"]
{{< /code-no-copy>}}

{{< alert color="warning" >}}
Do not open vim while logging a session with `script`, doing so will ruin the
log file. Instead, open a separate tmux window to use vim.
{{< /alert >}}


## Eliminating ANSI Escape Characters
Before uploading `script`-generated log files with your tickets, you might want
to eliminate the ANSI escape characters so the developers can actually read it.
First, install `ansifilter`.

```text
sudo apt install ansifilter
```

See the man pages, `man ansifilter`, for more details. For our purposes, the
following usage is likely all that will be required.

{{< code-no-copy lang="text" >}}
ansifilter -i INPUTFILE.ts -o OUTPUTFILE.txt
{{< /code-no-copy>}}

And voil√†! Your log file is now in plain readable text.
