<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>
            
                    sql protect on
                
            
            Clint A Jordan</title>
        <link>https://code.fs.usda.gov/pages/clint-jordan/site/tags/sql-protect/</link>
        <description>Recent content  in sql protect
            on Clint A Jordan</description>
        
        <lastBuildDate>Mon, 03 Apr 2023 17:20:24 -0600</lastBuildDate>
        <generator>Hugo -- gohugo.io</generator>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
            <atom:link href="https://code.fs.usda.gov/pages/clint-jordan/site/tags/sql-protect/index.xml" rel="self" type="application/rss&#43;xml" />
        
            
            <item>
                <title>SQL/Protect - importing into db clone</title>
                <link>https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/sql-protect/edb-backup-method/</link>
                
                
                <description>&lt;blockquote&gt;Importing SQL/Protect data into a backup&lt;/blockquote&gt;
&lt;h2 id=&#34;testing-procedure-overview&#34;&gt;Testing procedure overview&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#testing-procedure-overview&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;


&lt;p&gt;There are three different maintenance scenarios that will be frequently
encountered.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Import SQL/Protect data from a backup to a newly restored database.
&lt;ul&gt;
&lt;li&gt;this is possible per &lt;a href=&#34;https://www.enterprisedb.com/docs/epas/latest/epas_security_guide/02_protecting_against_sql_injection_attacks/04_backing_up_restoring_sql_protect/&#34;&gt;edb documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Import SQL/Protect &amp;ldquo;learned&amp;rdquo; data from a dev/test cluster to a production
cluster
&lt;ul&gt;
&lt;li&gt;currently unclear if this is possible&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Import SQL/Protect &amp;ldquo;learned&amp;rdquo; data from a backup to a newly updated/patched
database&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Scenario 1 is found explicitly in the EDB documentation, so testing for scenario
2 can reasonably serve for both 1 and 2. Scenario 3 will depend entirely on EDB
maintaining SQL/Protect compatibility between versions, so this will not be
tested until EPAS is upgraded.&lt;/p&gt;

&lt;h2 id=&#34;scenario-2-importing-between-clusters&#34;&gt;Scenario 2: Importing between clusters&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#scenario-2-importing-between-clusters&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;



&lt;h3 id=&#34;step-1-create-test-clusters&#34;&gt;Step 1: Create test clusters&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-1-create-test-clusters&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Create a cluster to simulate development environment

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
initdb -D ~/as13/data_db01d

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create a cluster to simulate production environment

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
initdb -D ~/as13/data_db01p

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Start both clusters

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
pg_ctl -D ~/as13/data_db01d -o &#34;-p 5443&#34; start
pg_ctl -D ~/as13/data_db01p -o &#34;-p 5444&#34; start

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Connecting to a cluster

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
psql &#34;port=5443&#34;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;step-2-create-databases-roles-and-schemas&#34;&gt;Step 2: Create databases, roles, and schemas&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-2-create-databases-roles-and-schemas&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Create database and roles. In this case there will be four user roles and
a single group role.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
CREATE DATABASE db01d;
CREATE USER user1 PASSWORD &#39;pw1&#39;;
CREATE USER user2 PASSWORD &#39;pw2&#39;;
CREATE USER user3 PASSWORD &#39;pw3&#39;;
CREATE USER user4 PASSWORD &#39;pw4&#39;;
CREATE ROLE group1 IDENTIFIED BY &#39;pwg1&#39;;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Ensure that new users (public schema) do not have the ability to connect by
default via the &lt;code&gt;public&lt;/code&gt; schema.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
REVOKE CONNECT ON DATABASE db01d FROM public;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Grant the connect privilege to all newly created users.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
GRANT CONNECT ON DATABASE db1 TO user1, user2, user3, user4;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Grant the &lt;code&gt;group1&lt;/code&gt; role to a specific set of users.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
GRANT group1 TO user2, user3;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Connect to database to create schemas (reminder: schemas are db level objects).

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;2,3&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01d
(psql 13.4.8, server 13.4.8)
You are now connected to database &#34;db01d&#34; as user &#34;enterprisedb&#34;.

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create schemas for each user/role.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
CREATE SCHEMA IF NOT EXISTS user1 AUTHORIZATION user1;
CREATE SCHEMA IF NOT EXISTS user2 AUTHORIZATION user2;
CREATE SCHEMA IF NOT EXISTS user3 AUTHORIZATION user3;
CREATE SCHEMA IF NOT EXISTS user4 AUTHORIZATION user4;
CREATE SCHEMA IF NOT EXISTS group1 AUTHORIZATION group1;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h4 id=&#34;grouped-commands&#34;&gt;Grouped commands&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#grouped-commands&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;


&lt;p&gt;Create database and roles on development cluster.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
psql &#34;port=5443&#34;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DATABASE&lt;/span&gt; db01d;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user1 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw1&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user2 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw2&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user3 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw3&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user4 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw4&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ROLE&lt;/span&gt; group1 IDENTIFIED &lt;span style=&#34;color:#66d9ef&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pwg1&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;REVOKE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;CONNECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DATABASE&lt;/span&gt; db01d &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;CONNECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DATABASE&lt;/span&gt; db01d &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user1, user2, user3, user4;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; group1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; group1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;c&lt;/span&gt; db01d;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user1 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user2 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user3 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user4 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user4;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; group1 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; group1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TABLE&lt;/span&gt; group1.t1(i VARCHAR);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; group1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; group1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user3;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create database and roles on production cluster.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
psql &#34;port=5444&#34;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DATABASE&lt;/span&gt; db01p;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user1 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw1&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user2 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw2&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user3 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw3&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;USER&lt;/span&gt; user4 PASSWORD &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pw4&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ROLE&lt;/span&gt; group1 IDENTIFIED &lt;span style=&#34;color:#66d9ef&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pwg1&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;REVOKE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;CONNECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DATABASE&lt;/span&gt; db01p &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;CONNECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DATABASE&lt;/span&gt; db01p &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user1, user2, user3, user4;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; group1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; group1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;c&lt;/span&gt; db01p;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user1 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user2 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user3 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; user4 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; user4;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SCHEMA&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXISTS&lt;/span&gt; group1 &lt;span style=&#34;color:#66d9ef&#34;&gt;AUTHORIZATION&lt;/span&gt; group1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TABLE&lt;/span&gt; group1.t1(i VARCHAR);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; group1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;GRANT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; group1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;TO&lt;/span&gt; user3;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&#34;step-3-enable-and-configure-sqlprotect&#34;&gt;Step 3: Enable and configure SQL/Protect&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-3-enable-and-configure-sqlprotect&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;



&lt;h4 id=&#34;modify-the-postgresqlconf-file&#34;&gt;Modify the &lt;code&gt;postgresql.conf&lt;/code&gt; file&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#modify-the-postgresqlconf-file&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;


&lt;p&gt;Development version (&lt;code&gt;/as13/data_db01d/postgresql.conf&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Shared Preload Libraries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;shared_preload_libraries = &amp;#39;$libdir/sqlprotect&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# SQL/Protect settings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.enabled = on
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.level = learn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_roles = 64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_relations = 1024
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_queries_to_save = 5000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Production version (&lt;code&gt;/as13/data_db01p/postgresql.conf&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Shared Preload Libraries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;shared_preload_libraries = &amp;#39;$libdir/sqlprotect&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# SQL/Protect settings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.enabled = on
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.level = active
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_roles = 64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_relations = 1024
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_queries_to_save = 5000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&#34;restart-the-database-servers&#34;&gt;Restart the database servers&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#restart-the-database-servers&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;


&lt;p&gt;
&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
pg_ctl -D ~/as13/data_db01d -o &#34;-p 5443&#34; stop
pg_ctl -D ~/as13/data_db01p -o &#34;-p 5444&#34; stop

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
pg_ctl -D ~/as13/data_db01d -o &#34;-p 5443&#34; start
pg_ctl -D ~/as13/data_db01p -o &#34;-p 5444&#34; start

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h4 id=&#34;run-sqlprotect-script-as-superuser&#34;&gt;Run SQL/Protect script as superuser&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#run-sqlprotect-script-as-superuser&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;



&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
\i /usr/edb/as13/share/contrib/sqlprotect.sql

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
\i /usr/edb/as13/share/contrib/sqlprotect.sql

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;h4 id=&#34;add-roles-to-the-protected-list&#34;&gt;Add roles to the protected list&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#add-roles-to-the-protected-list&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;


&lt;p&gt;Include the &lt;code&gt;sqlprotect&lt;/code&gt; schema  in the search path.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SET search_path TO sqlprotect;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Add roles to the protected list.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT protect_role(&#39;user1&#39;);
SELECT protect_role(&#39;user2&#39;);
SELECT protect_role(&#39;user3&#39;);
SELECT protect_role(&#39;user4&#39;);
SELECT protect_role(&#39;group1&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Enable expanded display.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
\x
Expanded display is on.

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected roles with OIDs.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2,4-100&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT * FROM edb_sql_protect;
-[ RECORD 1 ]------+------
dbid               | 16641
roleid             | 16642
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 2 ]------+------
dbid               | 16641
roleid             | 16643
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 3 ]------+------
dbid               | 16641
roleid             | 16644
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 4 ]------+------
dbid               | 16641
roleid             | 16645
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 5 ]------+------
dbid               | 16641
roleid             | 16646
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected roles with object names.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-100&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT * FROM list_protected_users;
-[ RECORD 1 ]------+-------
dbname             | db01d
username           | user1
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 2 ]------+-------
dbname             | db01d
username           | user2
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 3 ]------+-------
dbname             | db01d
username           | user3
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 4 ]------+-------
dbname             | db01d
username           | user4
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f
-[ RECORD 5 ]------+-------
dbname             | db01d
username           | group1
protect_relations  | t
allow_utility_cmds | f
allow_tautology    | f
allow_empty_dml    | f


            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;step-4-run-test-suite&#34;&gt;Step 4: Run test suite&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-4-run-test-suite&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;



&lt;h4 id=&#34;create-tables-with-user1&#34;&gt;Create tables with &lt;code&gt;user1&lt;/code&gt;&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#create-tables-with-user1&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;


&lt;p&gt;Connect as &lt;code&gt;user1&lt;/code&gt;.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01d user1
Password for user user1:
psql (13.10.14, server 13.10.14)
You are now connected to database &#34;db01d&#34; as user &#34;user1&#34;.

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create table

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;2-4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
CREATE TABLE t1(i varchar);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Insert data into tables

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;2-4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
INSERT INTO t1 values(&#39;this is user3 data in user1.t1&#39;);
INSERT INTO user4.t1 values(&#39;this is more user4 data in user4.t1&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h4 id=&#34;create-tables-with-user2&#34;&gt;Create tables with &lt;code&gt;user2&lt;/code&gt;&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#create-tables-with-user2&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;



&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01d user2
Password for user user2:
psql (13.10.14, server 13.10.14)
You are now connected to database &#34;db01d&#34; as user &#34;user2&#34;.

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create table user2.t1(i VARCHAR);
INSERT INTO user2.t1 values(&#39;this is user2 data in user2.t1&#39;);
INSERT INTO user2.t1 values(&#39;this is more user2 data in user2.t1&#39;);
INSERT INTO group1.t1 values(&#39;this is user2 data in group1.t1&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;h4 id=&#34;create-tables-with-user3&#34;&gt;Create tables with &lt;code&gt;user3&lt;/code&gt;&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#create-tables-with-user3&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;



&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01d user3
Password for user user3:
psql (13.10.14, server 13.10.14)
You are now connected to database &#34;db01d&#34; as user &#34;user3&#34;.

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create table user3.t1(i VARCHAR);
INSERT INTO user3.t1 values(&#39;this is user3 data in user3.t1&#39;);
INSERT INTO user3.t1 values(&#39;this is more user3 data in user3.t1&#39;);
INSERT INTO group1.t1 values(&#39;this is user3 data in group1.t1&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;h4 id=&#34;create-tables-with-user4&#34;&gt;Create tables with &lt;code&gt;user4&lt;/code&gt;&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#create-tables-with-user4&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;



&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01d user4
Password for user user4:
psql (13.10.14, server 13.10.14)
You are now connected to database &#34;db01d&#34; as user &#34;user4&#34;.

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create table user4.t1(i VARCHAR);
INSERT INTO user4.t1 values(&#39;this is user4 data in user4.t1&#39;);
INSERT INTO user4.t1 values(&#39;this is more user4 data in user4.t1&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;

&lt;p&gt;Create tables script.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;c&lt;/span&gt; db01d user1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;create&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt; user1.t1(i VARCHAR);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is user1 data in t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is more user1 data in t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;c&lt;/span&gt; db01d user2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;create&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt; user2.t1(i VARCHAR);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user2.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is user2 data in user2.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user2.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is more user2 data in user2.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; group1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is user2 data in group1.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;c&lt;/span&gt; db01d user3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;create&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt; user3.t1(i VARCHAR);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user3.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is user3 data in user3.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user3.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is more user3 data in user3.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; group1.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is user3 data in group1.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;c&lt;/span&gt; db01d user4;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;create&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt; user4.t1(i VARCHAR);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user4.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is user4 data in user4.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; user4.t1 &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;this is more user4 data in user4.t1&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&#34;optional-enable-active-mode-on-development-database&#34;&gt;Optional: enable active mode on development database&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#optional-enable-active-mode-on-development-database&#34;&gt;#&lt;/a&gt;&lt;/h4&gt;


&lt;p&gt;Set &lt;code&gt;edb_sql_protect.level = active&lt;/code&gt; in &lt;code&gt;/as13/data_db01d/postgresql.conf&lt;/code&gt;.
Reload &lt;code&gt;/as13/data_db01d/postgresql.conf&lt;/code&gt; after modification.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;2&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
pg_ctl reload -D as13/data_db01d/
server signaled

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;step-5-export-sqlprotect-data&#34;&gt;Step 5: Export SQL/Protect data&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-5-export-sqlprotect-data&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;



&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT sqlprotect.export_sqlprotect(&#39;/var/lib/edb/as13/backups/sqlprotect.dmp&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;h3 id=&#34;step-6-import-sqlprotect-data-into-production&#34;&gt;Step 6: Import SQL/Protect data into production&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-6-import-sqlprotect-data-into-production&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;For this test, there wasn&amp;rsquo;t any data in the SQL/Protect objects, but for a real
import, data would need to be removed from the objects so that the OIDs can be
corrected upon import.&lt;/p&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
DELETE FROM sqlprotect.edb_sql_protect_rel;
DELETE FROM sqlprotect.edb_sql_protect;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;

&lt;p&gt;Check for existing statistics.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT * FROM sqlprotect.edb_sql_protect_stats;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;If they do exist, drop them for each role.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT sqlprotect.drop_stats(&#39;user&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Check for existing offending queries.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT * FROM sqlprotect.edb_sql_protect_queries;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;If they do exist, drop them for each role.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
SELECT sqlprotect.drop_queries(&#39;user&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;step-7-import-sqlprotect-data&#34;&gt;Step 7: Import SQL/Protect data&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-7-import-sqlprotect-data&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Critical&lt;/strong&gt;: the role names that were protected by SQL/Protect in the development
cluster &lt;strong&gt;must&lt;/strong&gt; exist in the production cluster.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;step-8-enable-active-mode&#34;&gt;Step 8: Enable active mode&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-8-enable-active-mode&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;



&lt;h3 id=&#34;step-9-run-test-suite&#34;&gt;Step 9: Run test suite&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-9-run-test-suite&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;



&lt;h3 id=&#34;step-10-run-second-test-suit&#34;&gt;Step 10: Run second test suit&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-10-run-second-test-suit&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Run commands that will be blocked by SQL/Protect to ensure learned behavior has
been transferred.&lt;/p&gt;
</description>
                
                        <author>Clint.Jordan@fakeEmailToMakeValidatorHappy.com (Clint Jordan)</author>
                
                     
                        
                             
                            
                                
                                 
                                    <category domain="https://code.fs.usda.gov/pages/clint-jordan/site/categories/notes">notes</category>
                                
                            
                        
                     
                        
                             
                            
                                
                                 
                                    <category domain="https://code.fs.usda.gov/pages/clint-jordan/site/tags/edb">edb</category>
                                 
                                    <category domain="https://code.fs.usda.gov/pages/clint-jordan/site/tags/sql-protect">sql protect</category>
                                
                            
                        
                    
                
                <guid>https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/sql-protect/edb-backup-method/</guid>
                <pubDate>Wed, 22 Mar 2023 00:00:00 +0000</pubDate>
            </item>
        
            
            <item>
                <title>SQL/Protect - import/export between clusters</title>
                <link>https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/sql-protect/edb-cluster-export-method/</link>
                
                
                <description>&lt;blockquote&gt;Migrating SQL/Protect data between clusters&lt;/blockquote&gt;
&lt;h2 id=&#34;testing-procedure-overview&#34;&gt;Testing procedure overview&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#testing-procedure-overview&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;


&lt;p&gt;The intention of this test is to demonstrate that SQL/Protect data can be
transferred between two EPAS database clusters, which will allow production
servers to remain in active mode at all times. Most of the steps found in this
test were taken directly from the &lt;a href=&#34;https://www.enterprisedb.com/docs/epas/latest/epas_security_guide/02_protecting_against_sql_injection_attacks/04_backing_up_restoring_sql_protect/&#34;&gt;edb
documentation&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;step-1-cluster-setup&#34;&gt;Step 1: Cluster setup&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-1-cluster-setup&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;



&lt;h3 id=&#34;create-the-clusters&#34;&gt;Create the clusters&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#create-the-clusters&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Create a cluster to simulate a production environment

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
initdb -D ~/as13/data_p

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create a cluster to simulate a development environment

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
initdb -D ~/as13/data_d

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;modify-the-postgresqlconf-files&#34;&gt;Modify the &lt;code&gt;postgresql.conf&lt;/code&gt; files&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#modify-the-postgresqlconf-files&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Append the following lines to the production version (&lt;code&gt;/as13/data_p/postgresql.conf&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Shared Preload Libraries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;shared_preload_libraries = &amp;#39;$libdir/sqlprotect&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# SQL/Protect settings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.enabled = on
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.level = active
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_roles = 64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_relations = 1024
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_queries_to_save = 5000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Append the following lines to the development version (&lt;code&gt;/as13/data_d/postgresql.conf&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Shared Preload Libraries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;shared_preload_libraries = &amp;#39;$libdir/sqlprotect&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# SQL/Protect settings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.enabled = on
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.level = learn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_roles = 64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_protected_relations = 1024
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;edb_sql_protect.max_queries_to_save = 5000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&#34;start-the-clusters&#34;&gt;Start the clusters&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#start-the-clusters&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Start both clusters

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
pg_ctl -D ~/as13/data_p -o &#34;-p 5444&#34; start
pg_ctl -D ~/as13/data_d -o &#34;-p 5443&#34; start

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;connect-to-a-cluster&#34;&gt;Connect to a cluster&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#connect-to-a-cluster&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Connecting to a cluster

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-shell&#34;&gt;
                    
psql &#34;port=5444&#34;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;ensure-that-sqlprotect-is-enabled&#34;&gt;Ensure that SQL/Protect is enabled&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#ensure-that-sqlprotect-is-enabled&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Production

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;2-6,8-12,14-20&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
show shared_preload_libraries; 
 shared_preload_libraries
 --------------------------
  $libdir/sqlprotect
  (1 row)

show edb_sql_protect.enabled; 
 edb_sql_protect.enabled
 -------------------------
  on
  (1 row)

show edb_sql_protect.level;
 edb_sql_protect.level
 -----------------------
  active
  (1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Development

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;2-6,8-12,14-20&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
show shared_preload_libraries; 
 shared_preload_libraries
 --------------------------
  $libdir/sqlprotect
  (1 row)

show edb_sql_protect.enabled; 
 edb_sql_protect.enabled
 -------------------------
  on
  (1 row)

show edb_sql_protect.level;
 edb_sql_protect.level
 -----------------------
  learn
  (1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h2 id=&#34;step-2-create-databases-roles-and-schemas&#34;&gt;Step 2: Create databases, roles, and schemas&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-2-create-databases-roles-and-schemas&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;



&lt;h3 id=&#34;production-cluster&#34;&gt;Production cluster&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#production-cluster&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Create database &lt;code&gt;db01p&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
CREATE DATABASE db01p;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Connect to database

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01p

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create the &lt;code&gt;sqlprotect&lt;/code&gt; schema and objects

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
\i /usr/edb/as13/share/contrib/sqlprotect.sql

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create user and schema

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create schema test;
create user test;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Protect the new role, &lt;code&gt;test&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT sqlprotect.protect_role(&#39;test&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected users

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;2-10&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT * FROM sqlprotect.list_protected_users;
  dbname  | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
----------+----------+-------------------+--------------------+-----------------+-----------------
 cluster1 | test     | t                 | f                  | f               | f
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create tables

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;4&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create table test_table(i int);
insert into test_table select generate_series(1,100);
grant select on table test_table to test;

create table another_test_table(i int);
insert into another_test_table select generate_series(1,100);
grant select on table another_test_table to test;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Attempt to select from tables with user &lt;code&gt;test&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
set role test;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=&amp;gt;&#34;
            data-output=&#34;2,3,5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
select * from test_table limit 10;
ERROR:  SQLPROTECT: Illegal Query: relations

select * from another_test_table limit 10;
ERROR:  SQLPROTECT: Illegal Query: relations

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;

&lt;p&gt;Check the &lt;code&gt;roleid&lt;/code&gt; for the user &lt;code&gt;test&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT usesysid FROM pg_user WHERE usename=&#39;test&#39;;
 usesysid
----------
    16428
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected roles with OIDs (Object IDs).

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT * FROM sqlprotect.edb_sql_protect;
 dbid  | roleid | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
-------+--------+-------------------+--------------------+-----------------+-----------------
 16384 |  16428 | t                 | f                  | f               | f
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected roles with the object names.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT * FROM sqlprotect.list_protected_users;
 dbname | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
--------+----------+-------------------+--------------------+-----------------+-----------------
 db01p  | test     | t                 | f                  | f               | f
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Set the &lt;code&gt;protect_relations&lt;/code&gt; field to &lt;code&gt;&#39;f&#39;&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
update sqlprotect.edb_sql_protect set protect_relations=&#39;f&#39; where dbid=16384 and roleid=16428;
UPDATE 1

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Now attempt to select from the tables again

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=&amp;gt;&#34;
            data-output=&#34;2-8,10-25&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
select * from test_table limit 3;
 i
----
  1
  2
  3
(3 rows)

select * from another_test_table limit 3;
 i
----
  1
  2
  3
(3 rows)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h3 id=&#34;development-cluster&#34;&gt;Development cluster&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#development-cluster&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;p&gt;Create database &lt;code&gt;db01d&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
CREATE DATABASE db01d;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Connect to database

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;edb=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\c db01d

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create the &lt;code&gt;sqlprotect&lt;/code&gt; schema and objects

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
\i /usr/edb/as13/share/contrib/sqlprotect.sql

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;At this point, the two clusters are exactly the same down to the OIDs. For the
development test cluster additional users and tables will be created to ensure
that the OIDs between the objects of interest are different.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;3,6,9&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create schema user1;
create user user1;

create schema user2;
create user user2;

create schema user3;
create user user3;

create schema test;
create user test;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Protect the new role, &lt;code&gt;test&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT sqlprotect.protect_role(&#39;test&#39;);

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected users

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-10&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT * FROM sqlprotect.list_protected_users;
  dbname  | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
----------+----------+-------------------+--------------------+-----------------+-----------------
 cluster1 | test     | t                 | f                  | f               | f
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Create tables

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;4,8,12,16&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create table t1(i int);
insert into t1 select generate_series(1,100);
grant select on table t1 to user1;

create table t2(i int);
insert into t2 select generate_series(1,100);
grant select on table t2 to user2;

create table t3(i int);
insert into t3 select generate_series(1,100);
grant select on table t3 to user3;

create table test_table(i int);
insert into test_table select generate_series(1,100);
grant select on table test_table to test;

create table another_test_table(i int);
insert into another_test_table select generate_series(1,100);
grant select on table another_test_table to test;

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;Execute queries with user &lt;code&gt;test&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: it seems that a new psql session must be started before &amp;ldquo;learning&amp;rdquo; any
behavior after protecting a role.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
\q

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;enterprisedb $&#34;
            data-output=&#34;&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-text&#34;&gt;
                    
psql -p 5443 -d db01d -U test

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;2,3&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
create table yet_another_test_table(i int);
NOTICE:  SQLPROTECT: This command type is illegal for this user
CREATE TABLE

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=&amp;gt;&#34;
            data-output=&#34;2,3&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
db01d=&gt; insert into yet_another_test_table select generate_series(1,100);
NOTICE:  SQLPROTECT: Learned relation: 16453
INSERT 0 100

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01p=&amp;gt;&#34;
            data-output=&#34;2-9,11-25&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
select * from test_table limit 3;
NOTICE:  SQLPROTECT: Learned relation: 16444
 i
---
 1
 2
 3
(3 rows)

select * from another_test_table limit 3;
NOTICE:  SQLPROTECT: Learned relation: 16447
 i
---
 1
 2
 3
(3 rows)


            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;

&lt;p&gt;Check the &lt;code&gt;roleid&lt;/code&gt; for the user &lt;code&gt;test&lt;/code&gt;

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT usesysid FROM pg_user WHERE usename=&#39;test&#39;;
 usesysid
----------
    16434
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected roles with OIDs (Object IDs).

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT * FROM sqlprotect.edb_sql_protect;
 dbid  | roleid | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
-------+--------+-------------------+--------------------+-----------------+-----------------
 16384 |  16434 | t                 | f                  | f               | f
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;
&lt;p&gt;View the protected roles with the object names.

&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT * FROM sqlprotect.list_protected_users;
 dbname | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
--------+----------+-------------------+--------------------+-----------------+-----------------
 db01d  | test     | t                 | f                  | f               | f
(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;
&lt;/p&gt;

&lt;h2 id=&#34;step-3-export-and-import&#34;&gt;Step 3: Export and Import&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#step-3-export-and-import&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;



&lt;h3 id=&#34;export-data-from-development&#34;&gt;Export data from development&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#export-data-from-development&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;



&lt;html lang=&#34;en&#34;&gt;
&lt;div class=&#34;highlight&#34;&gt; 
    &lt;div class=&#34;code-toolbar&#34;&gt;
        &lt;pre 
            tabindex=&#34;0&#34; 
            style=&#34;
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                &#34;
            class=&#34;command-line&#34;
            lang=&#34;en&#34;
            data-prompt=&#34;db01d=#&#34;
            data-output=&#34;2-5&#34;
            data-filter-output=&#34;(out)&#34;
            data-continuation-str=&#34;&#34;
            date-continuation-prompt=&#34;-&amp;gt;&#34;
            &gt;

            &lt;code class=&#34;language-sql&#34;&gt;
                    
SELECT sqlprotect.export_sqlprotect(&#39;/var/lib/edb/as13/backups/sqlprotect.dmp&#39;);
 export_sqlprotect
-------------------

(1 row)

            &lt;/code&gt;
        &lt;/pre&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/html&gt;


&lt;h3 id=&#34;delete-all-sqlprotect-data-from-production&#34;&gt;Delete all SQL/Protect data from production&amp;nbsp;&lt;a class=&#34;headline-hash no-text-decoration&#34; href=&#34;#delete-all-sqlprotect-data-from-production&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;


&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# DELETE FROM sqlprotect.edb_sql_protect_rel;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DELETE 0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# DELETE FROM sqlprotect.edb_sql_protect;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DELETE 1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# SELECT * FROM sqlprotect.edb_sql_protect_stats;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; username | superusers | relations | commands | tautology | dml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;----------+------------+-----------+----------+-----------+-----
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; test     |          0 |         3 |        0 |         0 |   0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(1 row)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# SELECT sqlprotect.drop_stats(&amp;#39;test&amp;#39;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; drop_stats
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(1 row)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# SELECT * FROM sqlprotect.edb_sql_protect_stats;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; username | superusers | relations | commands | tautology | dml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;----------+------------+-----------+----------+-----------+-----
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(0 rows)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# SELECT * FROM sqlprotect.edb_sql_protect_queries;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; username | ip_address | port | machine_name |         date_time         |                               query
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;----------+------------+------+--------------+---------------------------+-------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; test     |            |      |              | 22-MAR-23 19:03:00 -05:00 | select * from another_test_table limit 10;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; test     |            |      |              | 22-MAR-23 19:03:00 -05:00 | SELECT r.rolname, r.rolsuper, r.rolinherit,                      +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           |   r.rolcreaterole, r.rolcreatedb, r.rolcanlogin,                 +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           |   r.rolconnlimit, r.rolvaliduntil,                               +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           |   ARRAY(SELECT b.rolname                                         +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           |         FROM pg_catalog.pg_auth_members m                        +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           |         JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)         +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           |         WHERE m.member = r.oid) as memberof                      +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , pg_catalog.shobj_description(r.oid, &amp;#39;pg_authid&amp;#39;) AS description+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , r.rolreplication                                               +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , r.rolbypassrls                                                 +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , r.rolprofile                                                   +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , edb_get_role_status(r.oid)                                     +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , edb_get_password_expiry_date(r.oid)                            +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | , r.rollockdate                                                  +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | FROM pg_catalog.pg_roles r                                       +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | WHERE r.rolname !~ &amp;#39;^pg_&amp;#39;                                        +
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          |            |      |              |                           | ORDER BY 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; test     |            |      |              | 22-MAR-23 19:03:00 -05:00 | select * from test_table limit 10;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(3 rows)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# SELECT sqlprotect.drop_queries(&amp;#39;test&amp;#39;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; drop_queries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(1 row)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;db01p=# SELECT sqlprotect.import_sqlprotect(&amp;#39;/var/lib/edb/as13/backups/sqlprotect.dmp&amp;#39;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; import_sqlprotect
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(1 row)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
                
                        <author>Clint.Jordan@fakeEmailToMakeValidatorHappy.com (Clint Jordan)</author>
                
                     
                        
                             
                            
                                
                                 
                                    <category domain="https://code.fs.usda.gov/pages/clint-jordan/site/categories/notes">notes</category>
                                
                            
                        
                     
                        
                             
                            
                                
                                 
                                    <category domain="https://code.fs.usda.gov/pages/clint-jordan/site/tags/edb">edb</category>
                                 
                                    <category domain="https://code.fs.usda.gov/pages/clint-jordan/site/tags/sql-protect">sql protect</category>
                                
                            
                        
                    
                
                <guid>https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/sql-protect/edb-cluster-export-method/</guid>
                <pubDate>Mon, 06 Mar 2023 00:00:00 +0000</pubDate>
            </item>
        
    </channel>
</rss>


