<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <link href="/css/prism.css" rel="stylesheet">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    
    
        <meta name="description" content="Migrating SQL/Protect data between clusters"/>
    

    
    
        <meta name="keywords" content="edb, sql protect, notes"/>
    

    <title>
        
            SQL/Protect - import/export between clusters ❚ Clint A Jordan
        
    </title>

    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.1);
         --theme-heading-color: #d4d5d6;
         --theme-body-color: #c1c3c5;
         --theme-body-bg-color: #343a40;
         --theme-hl1-color: #999c9f;
         --theme-hl1-font-color: #000;
         --theme-hl2-color: #707579;
         --theme-hl2-font-color: #000;
         --theme-hl3-transp-color: rgba(189, 181, 179, 0.5);
         --theme-block-quote-font-color: #999c9f;
         --theme-alert-color: #ac0000;
         --theme-warning-color: #caa61c;
         --theme-cursor-blink-color: #666;
         --theme-hamburger-bg-color: #343a40;
         --theme-table-odd-color: #5c6166;
         --theme-table-even-color: #484d53;
         --theme-inline-code-bg-color: #24282c;
         --theme-site-title-color: #d4d5d6;
     }
     
     html {
         line-height: 1.5;
     }

    </style>

    

    
    
    
    
    <link rel="stylesheet" href="/pages/clint-jordan/site/css/refined.min.707b5b2d74727b073232a67643329443fd686fc3a8db2d2ea29ee22293616518.css">
    
    <link rel="preload" href="/pages/clint-jordan/site/css/refined.min.707b5b2d74727b073232a67643329443fd686fc3a8db2d2ea29ee22293616518.css" as="style">
   
    

    



    
        <style>
         
         /* Background */ .bg { background-color: #ffffff; }
/* PreWrapper */ .chroma , .code-inline { background-color: #ffffff; }
/* Other */ .chroma .x , .code-inline .x {  }
/* Error */ .chroma .err , .code-inline .err { color: #a61717; background-color: #e3d2d2 }
/* CodeLine */ .chroma .cl , .code-inline .cl {  }
/* LineTableTD */ .chroma .lntd , .code-inline .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable , .code-inline .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; }
/* LineHighlight */ .chroma .hl , .code-inline .hl { background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt , .code-inline .lnt { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* LineNumbers */ .chroma .ln , .code-inline .ln { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
/* Line */ .chroma .line , .code-inline .line { display: flex; }
/* Keyword */ .chroma .k , .code-inline .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc , .code-inline .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd , .code-inline .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn , .code-inline .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp , .code-inline .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr , .code-inline .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt , .code-inline .kt { color: #445588; font-weight: bold }
/* Name */ .chroma .n , .code-inline .n {  }
/* NameAttribute */ .chroma .na , .code-inline .na { color: #008080 }
/* NameBuiltin */ .chroma .nb , .code-inline .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp , .code-inline .bp { color: #999999 }
/* NameClass */ .chroma .nc , .code-inline .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no , .code-inline .no { color: #008080 }
/* NameDecorator */ .chroma .nd , .code-inline .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni , .code-inline .ni { color: #800080 }
/* NameException */ .chroma .ne , .code-inline .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf , .code-inline .nf { color: #990000; font-weight: bold }
/* NameFunctionMagic */ .chroma .fm , .code-inline .fm {  }
/* NameLabel */ .chroma .nl , .code-inline .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn , .code-inline .nn { color: #555555 }
/* NameOther */ .chroma .nx , .code-inline .nx {  }
/* NameProperty */ .chroma .py , .code-inline .py {  }
/* NameTag */ .chroma .nt , .code-inline .nt { color: #000080 }
/* NameVariable */ .chroma .nv , .code-inline .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc , .code-inline .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg , .code-inline .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi , .code-inline .vi { color: #008080 }
/* NameVariableMagic */ .chroma .vm , .code-inline .vm {  }
/* Literal */ .chroma .l , .code-inline .l {  }
/* LiteralDate */ .chroma .ld , .code-inline .ld {  }
/* LiteralString */ .chroma .s , .code-inline .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa , .code-inline .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb , .code-inline .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc , .code-inline .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl , .code-inline .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd , .code-inline .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 , .code-inline .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se , .code-inline .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh , .code-inline .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si , .code-inline .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx , .code-inline .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr , .code-inline .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 , .code-inline .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss , .code-inline .ss { color: #990073 }
/* LiteralNumber */ .chroma .m , .code-inline .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb , .code-inline .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf , .code-inline .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh , .code-inline .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi , .code-inline .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il , .code-inline .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo , .code-inline .mo { color: #009999 }
/* Operator */ .chroma .o , .code-inline .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow , .code-inline .ow { color: #000000; font-weight: bold }
/* Punctuation */ .chroma .p , .code-inline .p {  }
/* Comment */ .chroma .c , .code-inline .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch , .code-inline .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm , .code-inline .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 , .code-inline .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs , .code-inline .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp , .code-inline .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf , .code-inline .cpf { color: #999999; font-weight: bold; font-style: italic }
/* Generic */ .chroma .g , .code-inline .g {  }
/* GenericDeleted */ .chroma .gd , .code-inline .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge , .code-inline .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr , .code-inline .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh , .code-inline .gh { color: #999999 }
/* GenericInserted */ .chroma .gi , .code-inline .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go , .code-inline .go { color: #888888 }
/* GenericPrompt */ .chroma .gp , .code-inline .gp { color: #555555 }
/* GenericStrong */ .chroma .gs , .code-inline .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu , .code-inline .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt , .code-inline .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl , .code-inline .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w , .code-inline .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */

/* GenericHeading, GenericSubheading */
.chroma .gh, .code-inline .gh,
.chroma .gu, .code-inline .gu {
    font-weight: bold;
}

/* Do not highlight error in pink background */
/* Error */
.chroma .err, .code-inline .err {
    background-color: inherit;
}

/* LineTable */
.chroma .lntable, .code-inline .lntable {
    width: auto;
    overflow-x: auto; /* Make the code block horizontally scrollable on narrow viewports. */
    display: block;
}

/* LineNumbersTable, LineNumbers, Line, LineHighlight */
/* Prevent the highlight from creating a strange artifact on line numbers. */
.chroma .lnt, .code-inline .lnt,
.chroma .ln, .code-inline .ln,
.chroma .line, .code-inline .line,
.chroma .hl, .code-inline .hl {
    display: flex;
}

/* Set the line highlight color to match the site's theme. */
/* LineHighlight */
.chroma .hl, .code-inline .hl {
    background-color: var(--theme-hl2-transp-color); /* This var is set in the head.html partial. */
}

/* Do not set the background color of inline src code*/
.chroma.inline-src, .code-inline {
    background-color: inherit;
}

         
        </style>
    


    
    
    

    
    <script src="/pages/clint-jordan/site/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js"></script>
    
    <link rel="preload" href="/pages/clint-jordan/site/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js" as="script">

    
    
    <script defer src="/pages/clint-jordan/site/js/libs/fa/fontawesome-all.min.8ac746494d9cdfb9bdf9d92e51cdd8b855ab69bcfc81918e2c6d95e7372b8529.js"></script>
    
    <link rel="preload" href="/pages/clint-jordan/site/js/libs/fa/fontawesome-all.min.8ac746494d9cdfb9bdf9d92e51cdd8b855ab69bcfc81918e2c6d95e7372b8529.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="SQL/Protect - import/export between clusters" />
<meta property="og:description" content="Migrating SQL/Protect data between clusters" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/sql-protect/edb-cluster-export-method/" />

    
    


    
        <meta property="article:published_time" content="2023-03-06T00:00:00&#43;00:00"/>
    
    
        <meta property="article:modified_time" content="2023-03-14T00:00:00&#43;00:00"/>
    









    




     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SQL/Protect - import/export between clusters"/>
<meta name="twitter:description" content="Migrating SQL/Protect data between clusters" />


    
    
    
     



    
    
    
        
    


     
        
        <meta name="DC.Creator" content="Clint Jordan"/>
    


    <meta name="author" content="Clint Jordan"/>



    
    
    
    <meta name="hugo-build-date" content=""/>
    <meta name="hugo-commit-hash" content=""/>
    <meta name="generator" content="Hugo 0.108.0">
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="" href="/">Home</a></li>
        
            
        
            
        
            
                <li><a class="" href="https://code.fs.usda.gov/pages/clint-jordan/site/docs/">Docs</a></li>
            
        
            
                <li><a class="" href="https://code.fs.usda.gov/pages/clint-jordan/site/notes/">Notes</a></li>
            
        
            
        
            
        
        
            <li><a class="" href="https://code.fs.usda.gov/pages/clint-jordan/site/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">Clint A Jordan</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        USDA FS CIO EDBA
                    </div>
                </header>

                






 

<article class="post h-entry notes">
    <header>
        <div class="center">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__notes__"
                                
                                
                                title="See all 15 posts categorized in ‘notes’"
                                
                            >
                                <a class="p-category" href="https://code.fs.usda.gov/pages/clint-jordan/site/categories/notes/">notes</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__edb__"
                                
                                
                                title="See all 12 posts tagged with ‘edb’"
                                
                            >
                                <a class="p-category" href="https://code.fs.usda.gov/pages/clint-jordan/site/tags/edb/">edb</a>
                            </li>
                        
                    
                        
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__sql-protect__"
                                
                                
                                title="See all 2 posts tagged with ‘sql protect’"
                                
                            >
                                <a class="p-category" href="https://code.fs.usda.gov/pages/clint-jordan/site/tags/sql-protect/">sql protect</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>

        <h1 class="post-title p-name">SQL/Protect - import/export between clusters</h1>

        
        <data class="u-url" value="https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/sql-protect/edb-cluster-export-method/"></data>

        <div class="date-syndication">
            


    
    
    <div class="post-date">
        
        <time datetime="2023-03-06T00:00:00+0000" class="dt-published" title="Published date">Mon Mar 6, 2023</time>
        
        
            
            <span class="dt-updated" title="Last modified date">[Tue Mar 14, 2023]</span>
        
    </div>


        </div>
         



    
    
    
        
    


    
        
        <span class="hide">
            &mdash; <a href="https://code.fs.usda.gov/pages/clint-jordan/site/" class="u-author">Clint Jordan</a>
        </span>
    



    </header>

    <div class="content">
        
    <div class="description p-summary">
        
        
        
        
        
            
            
        
        <p>Migrating SQL/Protect data between clusters</p>
    </div>



        





                       


        


        <div class="e-content">
            





<h2 id="testing-procedure-overview">Testing procedure overview&nbsp;<a class="headline-hash no-text-decoration" href="#testing-procedure-overview">#</a></h2>


<p>The intention of this test is to demonstrate that SQL/Protect data can be
transferred between two EPAS database clusters, which will allow production
servers to remain in active mode at all times. Most of the steps found in this
test were taken directly from the <a href="https://www.enterprisedb.com/docs/epas/latest/epas_security_guide/02_protecting_against_sql_injection_attacks/04_backing_up_restoring_sql_protect/">edb
documentation</a>.</p>

<h2 id="step-1-cluster-setup">Step 1: Cluster setup&nbsp;<a class="headline-hash no-text-decoration" href="#step-1-cluster-setup">#</a></h2>



<h3 id="create-the-clusters">Create the clusters&nbsp;<a class="headline-hash no-text-decoration" href="#create-the-clusters">#</a></h3>


<p>Create a cluster to simulate a production environment

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="enterprisedb $"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="&gt;"
            >

            <code class="language-shell">
                    
initdb -D ~/as13/data_p

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Create a cluster to simulate a development environment

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="enterprisedb $"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="&gt;"
            >

            <code class="language-shell">
                    
initdb -D ~/as13/data_d

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<h3 id="modify-the-postgresqlconf-files">Modify the <code>postgresql.conf</code> files&nbsp;<a class="headline-hash no-text-decoration" href="#modify-the-postgresqlconf-files">#</a></h3>


<p>Append the following lines to the production version (<code>/as13/data_p/postgresql.conf</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># Shared Preload Libraries
</span></span><span style="display:flex;"><span>shared_preload_libraries = &#39;$libdir/sqlprotect&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># SQL/Protect settings
</span></span><span style="display:flex;"><span>edb_sql_protect.enabled = on
</span></span><span style="display:flex;"><span>edb_sql_protect.level = active
</span></span><span style="display:flex;"><span>edb_sql_protect.max_protected_roles = 64
</span></span><span style="display:flex;"><span>edb_sql_protect.max_protected_relations = 1024
</span></span><span style="display:flex;"><span>edb_sql_protect.max_queries_to_save = 5000
</span></span></code></pre></div><p>Append the following lines to the development version (<code>/as13/data_d/postgresql.conf</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># Shared Preload Libraries
</span></span><span style="display:flex;"><span>shared_preload_libraries = &#39;$libdir/sqlprotect&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># SQL/Protect settings
</span></span><span style="display:flex;"><span>edb_sql_protect.enabled = on
</span></span><span style="display:flex;"><span>edb_sql_protect.level = learn
</span></span><span style="display:flex;"><span>edb_sql_protect.max_protected_roles = 64
</span></span><span style="display:flex;"><span>edb_sql_protect.max_protected_relations = 1024
</span></span><span style="display:flex;"><span>edb_sql_protect.max_queries_to_save = 5000
</span></span></code></pre></div>
<h3 id="start-the-clusters">Start the clusters&nbsp;<a class="headline-hash no-text-decoration" href="#start-the-clusters">#</a></h3>


<p>Start both clusters

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="enterprisedb $"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="&gt;"
            >

            <code class="language-shell">
                    
pg_ctl -D ~/as13/data_p -o "-p 5444" start
pg_ctl -D ~/as13/data_d -o "-p 5443" start

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<h3 id="connect-to-a-cluster">Connect to a cluster&nbsp;<a class="headline-hash no-text-decoration" href="#connect-to-a-cluster">#</a></h3>


<p>Connecting to a cluster

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="enterprisedb $"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="&gt;"
            >

            <code class="language-shell">
                    
psql "port=5444"

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<h3 id="ensure-that-sqlprotect-is-enabled">Ensure that SQL/Protect is enabled&nbsp;<a class="headline-hash no-text-decoration" href="#ensure-that-sqlprotect-is-enabled">#</a></h3>


<p>Production

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="edb=#"
            data-output="2-6,8-12,14-20"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
show shared_preload_libraries; 
 shared_preload_libraries
 --------------------------
  $libdir/sqlprotect
  (1 row)

show edb_sql_protect.enabled; 
 edb_sql_protect.enabled
 -------------------------
  on
  (1 row)

show edb_sql_protect.level;
 edb_sql_protect.level
 -----------------------
  active
  (1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Development

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="edb=#"
            data-output="2-6,8-12,14-20"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
show shared_preload_libraries; 
 shared_preload_libraries
 --------------------------
  $libdir/sqlprotect
  (1 row)

show edb_sql_protect.enabled; 
 edb_sql_protect.enabled
 -------------------------
  on
  (1 row)

show edb_sql_protect.level;
 edb_sql_protect.level
 -----------------------
  learn
  (1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<h2 id="step-2-create-databases-roles-and-schemas">Step 2: Create databases, roles, and schemas&nbsp;<a class="headline-hash no-text-decoration" href="#step-2-create-databases-roles-and-schemas">#</a></h2>



<h3 id="production-cluster">Production cluster&nbsp;<a class="headline-hash no-text-decoration" href="#production-cluster">#</a></h3>


<p>Create database <code>db01p</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="edb=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
CREATE DATABASE db01p;

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Connect to database

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="edb=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
\c db01p

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Create the <code>sqlprotect</code> schema and objects

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-text">
                    
\i /usr/edb/as13/share/contrib/sqlprotect.sql

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Create user and schema

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
create schema test;
create user test;

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Protect the new role, <code>test</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT sqlprotect.protect_role('test');

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>View the protected users

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output="2-10"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT * FROM sqlprotect.list_protected_users;
  dbname  | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
----------+----------+-------------------+--------------------+-----------------+-----------------
 cluster1 | test     | t                 | f                  | f               | f
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Create tables

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output="4"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
create table test_table(i int);
insert into test_table select generate_series(1,100);
grant select on table test_table to test;

create table another_test_table(i int);
insert into another_test_table select generate_series(1,100);
grant select on table another_test_table to test;

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Attempt to select from tables with user <code>test</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
set role test;

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=&gt;"
            data-output="2,3,5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
select * from test_table limit 10;
ERROR:  SQLPROTECT: Illegal Query: relations

select * from another_test_table limit 10;
ERROR:  SQLPROTECT: Illegal Query: relations

            </code>
        </pre>
    </div>
</div>
</html>

<p>Check the <code>roleid</code> for the user <code>test</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT usesysid FROM pg_user WHERE usename='test';
 usesysid
----------
    16428
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>View the protected roles with OIDs (Object IDs).

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT * FROM sqlprotect.edb_sql_protect;
 dbid  | roleid | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
-------+--------+-------------------+--------------------+-----------------+-----------------
 16384 |  16428 | t                 | f                  | f               | f
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>View the protected roles with the object names.

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT * FROM sqlprotect.list_protected_users;
 dbname | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
--------+----------+-------------------+--------------------+-----------------+-----------------
 db01p  | test     | t                 | f                  | f               | f
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Set the <code>protect_relations</code> field to <code>'f'</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
update sqlprotect.edb_sql_protect set protect_relations='f' where dbid=16384 and roleid=16428;
UPDATE 1

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Now attempt to select from the tables again

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=&gt;"
            data-output="2-8,10-25"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
select * from test_table limit 3;
 i
----
  1
  2
  3
(3 rows)

select * from another_test_table limit 3;
 i
----
  1
  2
  3
(3 rows)

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<h3 id="development-cluster">Development cluster&nbsp;<a class="headline-hash no-text-decoration" href="#development-cluster">#</a></h3>


<p>Create database <code>db01d</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="edb=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
CREATE DATABASE db01d;

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Connect to database

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="edb=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
\c db01d

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Create the <code>sqlprotect</code> schema and objects

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-text">
                    
\i /usr/edb/as13/share/contrib/sqlprotect.sql

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>At this point, the two clusters are exactly the same down to the OIDs. For the
development test cluster additional users and tables will be created to ensure
that the OIDs between the objects of interest are different.

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="3,6,9"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
create schema user1;
create user user1;

create schema user2;
create user user2;

create schema user3;
create user user3;

create schema test;
create user test;

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Protect the new role, <code>test</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT sqlprotect.protect_role('test');

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>View the protected users

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="2-10"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT * FROM sqlprotect.list_protected_users;
  dbname  | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
----------+----------+-------------------+--------------------+-----------------+-----------------
 cluster1 | test     | t                 | f                  | f               | f
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Create tables

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="4,8,12,16"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
create table t1(i int);
insert into t1 select generate_series(1,100);
grant select on table t1 to user1;

create table t2(i int);
insert into t2 select generate_series(1,100);
grant select on table t2 to user2;

create table t3(i int);
insert into t3 select generate_series(1,100);
grant select on table t3 to user3;

create table test_table(i int);
insert into test_table select generate_series(1,100);
grant select on table test_table to test;

create table another_test_table(i int);
insert into another_test_table select generate_series(1,100);
grant select on table another_test_table to test;

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>Execute queries with user <code>test</code></p>
<blockquote>
<p>Note: it seems that a new psql session must be started before &ldquo;learning&rdquo; any
behavior after protecting a role.</p>
</blockquote>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
\q

            </code>
        </pre>
    </div>
</div>
</html>


<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="enterprisedb $"
            data-output=""
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="&gt;"
            >

            <code class="language-text">
                    
psql -p 5443 -d db01d -U test

            </code>
        </pre>
    </div>
</div>
</html>


<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=&gt;"
            data-output="2,3"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
create table yet_another_test_table(i int);
NOTICE:  SQLPROTECT: This command type is illegal for this user
CREATE TABLE

            </code>
        </pre>
    </div>
</div>
</html>


<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=&gt;"
            data-output="2,3"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
db01d=> insert into yet_another_test_table select generate_series(1,100);
NOTICE:  SQLPROTECT: Learned relation: 16453
INSERT 0 100

            </code>
        </pre>
    </div>
</div>
</html>


<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01p=&gt;"
            data-output="2-9,11-25"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
select * from test_table limit 3;
NOTICE:  SQLPROTECT: Learned relation: 16444
 i
---
 1
 2
 3
(3 rows)

select * from another_test_table limit 3;
NOTICE:  SQLPROTECT: Learned relation: 16447
 i
---
 1
 2
 3
(3 rows)


            </code>
        </pre>
    </div>
</div>
</html>

<p>Check the <code>roleid</code> for the user <code>test</code>

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT usesysid FROM pg_user WHERE usename='test';
 usesysid
----------
    16434
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>View the protected roles with OIDs (Object IDs).

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT * FROM sqlprotect.edb_sql_protect;
 dbid  | roleid | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
-------+--------+-------------------+--------------------+-----------------+-----------------
 16384 |  16434 | t                 | f                  | f               | f
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>
<p>View the protected roles with the object names.

<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT * FROM sqlprotect.list_protected_users;
 dbname | username | protect_relations | allow_utility_cmds | allow_tautology | allow_empty_dml
--------+----------+-------------------+--------------------+-----------------+-----------------
 db01d  | test     | t                 | f                  | f               | f
(1 row)

            </code>
        </pre>
    </div>
</div>
</html>
</p>

<h2 id="step-3-export-and-import">Step 3: Export and Import&nbsp;<a class="headline-hash no-text-decoration" href="#step-3-export-and-import">#</a></h2>



<h3 id="export-data-from-development">Export data from development&nbsp;<a class="headline-hash no-text-decoration" href="#export-data-from-development">#</a></h3>



<html lang="en">
<div class="highlight"> 
    <div class="code-toolbar">
        <pre 
            tabindex="0" 
            style="
                display:block;
                color:#f8f8f2;
                background-color:#272822;
                -moz-tab-size:4;
                -o-tab-size:4;tab-size:4;
                "
            class="command-line"
            lang="en"
            data-prompt="db01d=#"
            data-output="2-5"
            data-filter-output="(out)"
            data-continuation-str=""
            date-continuation-prompt="-&gt;"
            >

            <code class="language-sql">
                    
SELECT sqlprotect.export_sqlprotect('/var/lib/edb/as13/backups/sqlprotect.dmp');
 export_sqlprotect
-------------------

(1 row)

            </code>
        </pre>
    </div>
</div>
</html>


<h3 id="delete-all-sqlprotect-data-from-production">Delete all SQL/Protect data from production&nbsp;<a class="headline-hash no-text-decoration" href="#delete-all-sqlprotect-data-from-production">#</a></h3>


<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>db01p=# DELETE FROM sqlprotect.edb_sql_protect_rel;
</span></span><span style="display:flex;"><span>DELETE 0
</span></span><span style="display:flex;"><span>db01p=# DELETE FROM sqlprotect.edb_sql_protect;
</span></span><span style="display:flex;"><span>DELETE 1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>db01p=# SELECT * FROM sqlprotect.edb_sql_protect_stats;
</span></span><span style="display:flex;"><span> username | superusers | relations | commands | tautology | dml
</span></span><span style="display:flex;"><span>----------+------------+-----------+----------+-----------+-----
</span></span><span style="display:flex;"><span> test     |          0 |         3 |        0 |         0 |   0
</span></span><span style="display:flex;"><span>(1 row)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>db01p=# SELECT sqlprotect.drop_stats(&#39;test&#39;);
</span></span><span style="display:flex;"><span> drop_stats
</span></span><span style="display:flex;"><span>------------
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(1 row)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>db01p=# SELECT * FROM sqlprotect.edb_sql_protect_stats;
</span></span><span style="display:flex;"><span> username | superusers | relations | commands | tautology | dml
</span></span><span style="display:flex;"><span>----------+------------+-----------+----------+-----------+-----
</span></span><span style="display:flex;"><span>(0 rows)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db01p=# SELECT * FROM sqlprotect.edb_sql_protect_queries;
</span></span><span style="display:flex;"><span> username | ip_address | port | machine_name |         date_time         |                               query
</span></span><span style="display:flex;"><span>----------+------------+------+--------------+---------------------------+-------------------------------------------------------------------
</span></span><span style="display:flex;"><span> test     |            |      |              | 22-MAR-23 19:03:00 -05:00 | select * from another_test_table limit 10;
</span></span><span style="display:flex;"><span> test     |            |      |              | 22-MAR-23 19:03:00 -05:00 | SELECT r.rolname, r.rolsuper, r.rolinherit,                      +
</span></span><span style="display:flex;"><span>          |            |      |              |                           |   r.rolcreaterole, r.rolcreatedb, r.rolcanlogin,                 +
</span></span><span style="display:flex;"><span>          |            |      |              |                           |   r.rolconnlimit, r.rolvaliduntil,                               +
</span></span><span style="display:flex;"><span>          |            |      |              |                           |   ARRAY(SELECT b.rolname                                         +
</span></span><span style="display:flex;"><span>          |            |      |              |                           |         FROM pg_catalog.pg_auth_members m                        +
</span></span><span style="display:flex;"><span>          |            |      |              |                           |         JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)         +
</span></span><span style="display:flex;"><span>          |            |      |              |                           |         WHERE m.member = r.oid) as memberof                      +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , pg_catalog.shobj_description(r.oid, &#39;pg_authid&#39;) AS description+
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , r.rolreplication                                               +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , r.rolbypassrls                                                 +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , r.rolprofile                                                   +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , edb_get_role_status(r.oid)                                     +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , edb_get_password_expiry_date(r.oid)                            +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | , r.rollockdate                                                  +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | FROM pg_catalog.pg_roles r                                       +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | WHERE r.rolname !~ &#39;^pg_&#39;                                        +
</span></span><span style="display:flex;"><span>          |            |      |              |                           | ORDER BY 1;
</span></span><span style="display:flex;"><span> test     |            |      |              | 22-MAR-23 19:03:00 -05:00 | select * from test_table limit 10;
</span></span><span style="display:flex;"><span>(3 rows)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db01p=# SELECT sqlprotect.drop_queries(&#39;test&#39;);
</span></span><span style="display:flex;"><span> drop_queries
</span></span><span style="display:flex;"><span>--------------
</span></span><span style="display:flex;"><span>            3
</span></span><span style="display:flex;"><span>(1 row)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db01p=# SELECT sqlprotect.import_sqlprotect(&#39;/var/lib/edb/as13/backups/sqlprotect.dmp&#39;);
</span></span><span style="display:flex;"><span> import_sqlprotect
</span></span><span style="display:flex;"><span>-------------------
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(1 row)
</span></span></code></pre></div>

        </div>
    </div>
</article>



                <footer>
                    



    

    

    

    

    

    

    

    

    

    

    

    

    

    

    









<div class="no-text-decoration">
    <div class="jump top"><a href="#" title="Top of this page">⮉</a></div>
    <div class="jump bottom"><a href="#bottom" title="Bottom of this page">⮋</a></div>
</div>


 
    
        <div class="hugotoc no-text-decoration">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#testing-procedure-overview">Testing procedure overview</a></li>
    <li><a href="#step-1-cluster-setup">Step 1: Cluster setup</a>
      <ul>
        <li><a href="#create-the-clusters">Create the clusters</a></li>
        <li><a href="#modify-the-postgresqlconf-files">Modify the <code>postgresql.conf</code> files</a></li>
        <li><a href="#start-the-clusters">Start the clusters</a></li>
        <li><a href="#connect-to-a-cluster">Connect to a cluster</a></li>
        <li><a href="#ensure-that-sqlprotect-is-enabled">Ensure that SQL/Protect is enabled</a></li>
      </ul>
    </li>
    <li><a href="#step-2-create-databases-roles-and-schemas">Step 2: Create databases, roles, and schemas</a>
      <ul>
        <li><a href="#production-cluster">Production cluster</a></li>
        <li><a href="#development-cluster">Development cluster</a></li>
      </ul>
    </li>
    <li><a href="#step-3-export-and-import">Step 3: Export and Import</a>
      <ul>
        <li><a href="#export-data-from-development">Export data from development</a></li>
        <li><a href="#delete-all-sqlprotect-data-from-production">Delete all SQL/Protect data from production</a></li>
      </ul>
    </li>
  </ul>
</nav>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    
    
<script src="/pages/clint-jordan/site/js/libs/jquery/3.3.1/jquery.slim.min.min.6bf8d45bc866d423891a388771b8214fd885730dd44643e7f088c23ef6af0195.js"></script>

<link rel="preload" href="/pages/clint-jordan/site/js/libs/jquery/3.3.1/jquery.slim.min.min.6bf8d45bc866d423891a388771b8214fd885730dd44643e7f088c23ef6af0195.js" as="script">

<script>(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>




















<div class="backtotop center no-text-decoration clear-float">
    <a href="#">back to <span class="top">top</span></a>
</div>


<div class="right">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__notes__"
                                
                                
                                title="See all 15 posts categorized in ‘notes’"
                                
                            >
                                <a class="p-category" href="https://code.fs.usda.gov/pages/clint-jordan/site/categories/notes/">notes</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__edb__"
                                
                                
                                title="See all 12 posts tagged with ‘edb’"
                                
                            >
                                <a class="p-category" href="https://code.fs.usda.gov/pages/clint-jordan/site/tags/edb/">edb</a>
                            </li>
                        
                    
                        
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__sql-protect__"
                                
                                
                                title="See all 2 posts tagged with ‘sql protect’"
                                
                            >
                                <a class="p-category" href="https://code.fs.usda.gov/pages/clint-jordan/site/tags/sql-protect/">sql protect</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>
<div class="clear-float"></div>



<div class="prev-next-navigator clear-float">
    
        <span class="prev-post left no-text-decoration">
            <a href="https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/edb-pgdump-pgrestore/">«&nbsp;pg_dump and pg_restore</a>
        </span>
    
    
        <span class="next-post right no-text-decoration">
            <a href="https://code.fs.usda.gov/pages/clint-jordan/site/notes/edb/edb-variables/">Variables&nbsp;»</a>
        </span>
    
</div>
 








 


                    <ul class="no-bullets feed right inline">
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                


<ul class="social no-text-decoration">
    
</ul>

















<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script>var nav=responsiveNav("#nav");</script>





    
    <script defer src="/pages/clint-jordan/site/js/libs/fragmentions/wrapper.min.e1fd157af6f06da6b172f857818a3f1b90c0a8ef1d530570c92e28ac906520c9.js"></script>










            </footer>
        </div> 
        <script src="/js/prism.js"></script>  
    </body>
</html>
